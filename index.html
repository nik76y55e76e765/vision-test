<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Camera Preview Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000; 
            font-family: 'Courier New', monospace; 
            color: #00ffcc;
            position: fixed;
        }
        
        #cameraView {
            width: 100%;
            height: 60vh;
            object-fit: cover;
            background: #111;
            display: block;
        }
        
        #controlPanel {
            width: 100%;
            height: 40vh;
            overflow-y: auto;
            background: rgba(0, 10, 10, 0.98);
            padding: 15px;
        }
        
        .status {
            background: rgba(0, 50, 50, 0.8);
            padding: 10px;
            border: 1px solid #00ffcc;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        .control-group {
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #00ffcc22;
        }
        
        .control-group label {
            display: block;
            font-size: 10px;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00ffcc;
        }
        
        .value-display {
            display: inline-block;
            margin-left: 10px;
            color: #fff;
            font-weight: bold;
        }
        
        input[type=range] {
            width: 100%;
            height: 30px;
            accent-color: #00ffcc;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: #00ffcc;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
        }
        
        button:disabled {
            background: #666;
            color: #999;
        }
        
        button.secondary {
            background: rgba(0, 255, 204, 0.2);
            color: #00ffcc;
            border: 1px solid #00ffcc;
        }
    </style>
</head>
<body>
    <video id="cameraView" autoplay playsinline muted></video>
    
    <div id="controlPanel">
        <div class="status" id="status">
            üìπ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã...
        </div>
        
        <div class="control-group">
            <label>
                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
                <span class="value-display" id="pCountValue">2000</span>
            </label>
            <input type="range" id="pCount" min="500" max="5000" step="100" value="2000">
        </div>
        
        <div class="control-group">
            <label>
                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–ª—ã—Ö —á–∞—Å—Ç–∏—Ü  
                <span class="value-display" id="cCountValue">1000</span>
            </label>
            <input type="range" id="cCount" min="100" max="3000" step="100" value="1000">
        </div>
        
        <div class="control-group">
            <label>
                –°–∏–ª–∞ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è
                <span class="value-display" id="attractValue">0.5</span>
            </label>
            <input type="range" id="attract" min="0.0" max="1.0" step="0.1" value="0.5">
        </div>
        
        <div class="control-group">
            <label>
                –†–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –≤ AR
                <span class="value-display" id="scaleValue">0.3</span>
            </label>
            <input type="range" id="scale" min="0.1" max="1.0" step="0.1" value="0.3">
        </div>
        
        <button id="testButton" disabled>–ü–†–û–í–ï–†–ö–ê –ö–ê–ú–ï–†–´...</button>
        <button id="arButton" class="secondary" disabled style="display:none;">–í–û–ô–¢–ò –í AR –†–ï–ñ–ò–ú</button>
    </div>

    <script>
        let cameraStream = null;
        
        const statusDiv = document.getElementById('status');
        const cameraView = document.getElementById('cameraView');
        const testButton = document.getElementById('testButton');
        const arButton = document.getElementById('arButton');
        
        // –°–ª–∞–π–¥–µ—Ä—ã
        const pCount = document.getElementById('pCount');
        const cCount = document.getElementById('cCount');
        const attract = document.getElementById('attract');
        const scale = document.getElementById('scale');
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
        pCount.oninput = () => {
            document.getElementById('pCountValue').textContent = pCount.value;
        };
        cCount.oninput = () => {
            document.getElementById('cCountValue').textContent = cCount.value;
        };
        attract.oninput = () => {
            document.getElementById('attractValue').textContent = attract.value;
        };
        scale.oninput = () => {
            document.getElementById('scaleValue').textContent = scale.value;
        };
        
        // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
        async function startCamera() {
            try {
                statusDiv.textContent = 'üìπ –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });
                
                cameraView.srcObject = stream;
                cameraStream = stream;
                
                statusDiv.textContent = '‚úÖ –ö–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –í–∏–¥–∏—à—å –∫–æ–º–Ω–∞—Ç—É?';
                testButton.textContent = '–ö–ê–ú–ï–†–ê –†–ê–ë–û–¢–ê–ï–¢ ‚úì';
                testButton.disabled = false;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ AR –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                checkARSupport();
                
            } catch(err) {
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: ' + err.message;
                testButton.textContent = '–û–®–ò–ë–ö–ê –ö–ê–ú–ï–†–´';
                console.error('Camera error:', err);
            }
        }
        
        async function checkARSupport() {
            if ('xr' in navigator) {
                try {
                    const supported = await navigator.xr.isSessionSupported('immersive-ar');
                    if (supported) {
                        arButton.style.display = 'block';
                        arButton.disabled = false;
                        arButton.textContent = '–í–û–ô–¢–ò –í AR –†–ï–ñ–ò–ú (–ì–û–¢–û–í–û)';
                        arButton.onclick = enterAR;
                    } else {
                        arButton.style.display = 'block';
                        arButton.textContent = 'AR –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢–°–Ø';
                    }
                } catch(e) {
                    console.error('AR check error:', e);
                }
            } else {
                arButton.style.display = 'block';
                arButton.textContent = 'WEBXR –ù–ï –ù–ê–ô–î–ï–ù';
            }
        }
        
        function enterAR() {
            alert('AR —Ä–µ–∂–∏–º –±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏!\n\n–°–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–Ω—ã.');
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', startCamera);
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>


