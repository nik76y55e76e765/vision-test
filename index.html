<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <script>
      // Скрипт для поиска поверхностей (Hit-Test)
      AFRAME.registerComponent('ar-hit-test', {
        init: function () {
          this.xrHitTestSource = null;
          this.viewerSpace = null;
          this.el.sceneEl.renderer.xr.addEventListener('sessionstart', async () => {
            let session = this.el.sceneEl.renderer.xr.getSession();
            this.viewerSpace = await session.requestReferenceSpace('viewer');
            this.xrHitTestSource = await session.requestHitTestSource({ space: this.viewerSpace });
          });
        },
        tick: function () {
          let frame = this.el.sceneEl.frame;
          if (!frame || !this.xrHitTestSource) return;
          let hitTestResults = frame.getHitTestResults(this.xrHitTestSource);
          if (hitTestResults.length > 0) {
            let pose = hitTestResults[0].getPose(this.el.sceneEl.renderer.xr.getReferenceSpace());
            this.el.setAttribute('position', pose.transform.position);
            this.el.setAttribute('rotation', {x: -90, y: 0, z: 0});
            this.el.setAttribute('visible', true);
          }
        }
      });
    </script>

    <a-scene webxr="optionalFeatures: hit-test, local-floor; overlayElement: #gui;">
      <a-entity camera position="0 1.6 0"></a-entity>

      <a-entity id="reticle" ar-hit-test visible="false">
        <a-ring color="#00ffcc" radius-inner="0.04" radius-outer="0.05"></a-ring>
        <a-text value="OBJECT" align="center" position="0 0.1 0" scale="0.2 0.2 0.2" color="#00ffcc"></a-text>
      </a-entity>
    </a-scene>

    <div id="gui" style="position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);">
        <button onclick="document.querySelector('a-scene').enterAR()" style="padding: 20px; background: #00ffcc; border: none; border-radius: 10px; font-weight: bold;">
            ЗАПУСТИТЬ СКАНЕР
        </button>
    </div>
  </body>
</html>

