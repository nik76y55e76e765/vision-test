<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Digital Soul: AR Scanner</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      #gui {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
        z-index: 10001; /* –ü–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
        pointer-events: auto;
      }
      button {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        font-family: sans-serif;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      }
      .btn-start { background: #00ffcc; color: #000; }
      .btn-reload { background: #555; color: #fff; }
      .btn-exit { background: #ff4444; color: #fff; }
    </style>
  </head>
  <body>
    
    <div id="gui">
        <button class="btn-start" onclick="document.querySelector('a-scene').enterAR()">–ó–ê–ü–£–°–¢–ò–¢–¨</button>
        <button class="btn-reload" onclick="window.location.reload()">üîÑ</button>
        <button class="btn-exit" onclick="document.querySelector('a-scene').exitVR()">–í–´–•–û–î</button>
    </div>

    <a-scene webxr="optionalFeatures: hit-test, local-floor, dom-overlay; overlayElement: #gui;" ar-handler>
      
      <a-entity camera position="0 1.6 0"></a-entity>

      <a-entity id="reticle" visible="false">
        <a-ring color="#00ffcc" radius-inner="0.04" radius-outer="0.05" rotation="-90 0 0" opacity="0.9"></a-ring>
        <a-sphere radius="0.005" color="#00ffcc"></a-sphere>
      </a-entity>

      <script>
        AFRAME.registerComponent('ar-handler', {
          init: function () {
            this.xrHitTestSource = null;
            this.viewerSpace = null;
            this.reticle = document.getElementById('reticle');

            this.el.sceneEl.renderer.xr.addEventListener('sessionstart', async () => {
              let session = this.el.sceneEl.renderer.xr.getSession();
              // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∑—Ä–∏—Ç–µ–ª—è
              this.viewerSpace = await session.requestReferenceSpace('viewer');
              // –ò—Å—Ç–æ—á–Ω–∏–∫ –ª—É—á–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π
              this.xrHitTestSource = await session.requestHitTestSource({ space: this.viewerSpace });
            });
          },
          tick: function () {
            const frame = this.el.sceneEl.frame;
            if (!frame || !this.xrHitTestSource) return;

            const hitTestResults = frame.getHitTestResults(this.xrHitTestSource);
            if (hitTestResults.length > 0) {
              const pose = hitTestResults[0].getPose(this.el.sceneEl.renderer.xr.getReferenceSpace());
              this.reticle.setAttribute('position', pose.transform.position);
              // –£–±–∏—Ä–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –∫–æ–¥–∞, —á—Ç–æ–±—ã –æ–Ω–æ –ª–æ–∂–∏–ª–æ—Å—å –ø–ª–æ—Å–∫–æ –ø–æ —Å–µ—Ç–∫–µ
              this.reticle.setAttribute('visible', true);
            }
          }
        });
      </script>

    </a-scene>
  </body>
</html>

